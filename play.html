<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Rush & Dodge</title>
  <link rel="icon" href="favicon.png" />
  <link rel="stylesheet" href="style.css" />
  <meta name="description" content="Rush & Dodge - game nÃ© chÆ°á»›ng ngáº¡i váº­t. ChÆ¡i ngay, ghi Ä‘iá»ƒm cao vÃ  so tÃ i báº£ng xáº¿p háº¡ng!" />
</head>
<body>
  <!-- Leaderboard button -->
  <button id="leaderBtn" class="icon-btn" title="Báº£ng xáº¿p háº¡ng">ğŸ†</button>

  <!-- Intro (index-like) -->
  <section id="intro" class="intro">
    <img src="logo.png" alt="Rush & Dodge Logo" class="logo" />
    <h1>Rush & Dodge</h1>
    <p class="tagline">Äiá»u khiá»ƒn nhÃ¢n váº­t, nÃ© chÆ°á»›ng ngáº¡i váº­t rÆ¡i xuá»‘ng. Sá»‘ng lÃ¢u cÃ ng nhiá»u Ä‘iá»ƒm!</p>

    <div class="instructions">
      <h3>ğŸ“– HÆ°á»›ng dáº«n</h3>
      <ul>
        <li>DÃ¹ng phÃ­m <b>â†</b> vÃ  <b>â†’</b> Ä‘á»ƒ di chuyá»ƒn.</li>
        <li>Má»—i giÃ¢y sá»‘ng = +1 Ä‘iá»ƒm. Äáº¡t <b>500s</b> = hoÃ n thÃ nh 1 vÃ²ng.</li>
        <li>Nháº­p tÃªn (duy nháº¥t) trÆ°á»›c khi chÆ¡i â€” Ä‘Æ°á»£c dÃ¹ng cho báº£ng xáº¿p háº¡ng cá»¥c bá»™.</li>
      </ul>
    </div>

    <div class="controls-row">
      <input id="nameInput" placeholder="TÃªn cá»§a báº¡n (khÃ´ng trÃ¹ng)"/>
      <button id="registerBtn" class="small-btn">ÄÄƒng kÃ½ & LÆ°u tÃªn</button>
    </div>

    <button id="startBtn" class="big-btn">â–¶ Báº¯t Ä‘áº§u chÆ¡i</button>
    <div id="introMsg" class="muted"></div>
  </section>

  <!-- Leaderboard Modal -->
  <div id="leaderModal" class="modal">
    <div class="modal-content large">
      <div class="modal-header">
        <h3>Báº£ng xáº¿p háº¡ng (cá»¥c bá»™)</h3>
        <button id="closeLeader" class="small-btn">ÄÃ³ng</button>
      </div>
      <div id="leaderList" class="leader-list">Äang táº£i...</div>
    </div>
  </div>

  <!-- Game Area (hidden until Play) -->
  <section id="gameSection" class="hidden">
    <div class="topbar">
      <div><strong id="playerTag">ChÆ°a Ä‘Äƒng kÃ½</strong></div>
      <div id="hud">
        <span id="scoreDisplay">Score: 0</span>
        <span id="highDisplay">High: 0</span>
        <span id="compDisplay">Completions: 0</span>
      </div>
    </div>

    <div class="game-frame">
      <canvas id="gameCanvas" width="360" height="560"></canvas>
    </div>

    <div class="controls-note muted">Nháº¥n <b>Space</b> Ä‘á»ƒ chÆ¡i láº¡i khi cháº¿t. â† / â†’ Ä‘á»ƒ di chuyá»ƒn.</div>
  </section>

  <footer>
    <p>Â© 2025 Obstacle Dash â€” Made with â¤ï¸</p>
  </footer>

  <script src="game.js"></script>
  <script>
    // UI wiring
    const intro = document.getElementById('intro');
    const gameSection = document.getElementById('gameSection');
    const startBtn = document.getElementById('startBtn');
    const registerBtn = document.getElementById('registerBtn');
    const nameInput = document.getElementById('nameInput');
    const introMsg = document.getElementById('introMsg');
    const playerTag = document.getElementById('playerTag');
    const leaderBtn = document.getElementById('leaderBtn');
    const leaderModal = document.getElementById('leaderModal');
    const closeLeader = document.getElementById('closeLeader');
    const leaderList = document.getElementById('leaderList');

    // load saved player name if any
    const savedName = localStorage.getItem('od_player_name');
    if (savedName) {
      nameInput.value = savedName;
      playerTag.textContent = `Player: ${savedName}`;
    }

    registerBtn.addEventListener('click', () => {
      const name = (nameInput.value || '').trim();
      if (!name) { introMsg.textContent = 'TÃªn khÃ´ng Ä‘Æ°á»£c Ä‘á»ƒ trá»‘ng.'; return; }
      const ok = window.OD_RegisterPlayerLocal(name);
      if (!ok.success) {
        introMsg.textContent = ok.message;
        return;
      }
      introMsg.textContent = 'ÄÄƒng kÃ½ thÃ nh cÃ´ng. Báº¡n cÃ³ thá»ƒ báº¥m Báº¯t Ä‘áº§u.';
      playerTag.textContent = `Player: ${name}`;
      localStorage.setItem('od_player_name', name);
    });

    startBtn.addEventListener('click', () => {
      // require name
      const currentName = localStorage.getItem('od_player_name');
      if (!currentName) {
        introMsg.textContent = 'Vui lÃ²ng nháº­p tÃªn vÃ  Ä‘Äƒng kÃ½ trÆ°á»›c khi chÆ¡i.';
        return;
      }
      intro.style.display = 'none';
      gameSection.classList.remove('hidden');
      // call game start
      window.startGame();
    });

    // leaderboard UI
    leaderBtn.addEventListener('click', async () => {
      leaderModal.style.display = 'flex';
      leaderList.innerHTML = 'Äang táº£i...';
      const list = window.OD_LoadLeaderboardLocal();
      if (!list.length) {
        leaderList.innerHTML = '<div class="muted">ChÆ°a cÃ³ ngÆ°á»i chÆ¡i</div>';
        return;
      }
      leaderList.innerHTML = '';
      // sort by completions desc then highScore desc
      list.sort((a,b) => (b.completions - a.completions) || (b.highScore - a.highScore));
      const max = Math.min(list.length, 1000);
      for (let i=0;i<max;i++){
        const p = list[i];
        const el = document.createElement('div');
        el.className = 'leader-item';
        el.innerHTML = `<div class="left"><div class="rank">${i+1}</div><div><strong>${escapeHtml(p.name)}</strong><div class="muted">completions: ${p.completions}</div></div></div><div>High: ${p.highScore || 0}</div>`;
        leaderList.appendChild(el);
      }
    });
    closeLeader.addEventListener('click', ()=> leaderModal.style.display = 'none');

    // helper escape
    function escapeHtml(s){ return (''+s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

  </script>
</body>
</html>
